/*! by da宗熊  https://github.com/linfenpan/waterfall */
(function(b){var a={minWidth:300,itemWidth:300,cellWSpace:10,cellHSpace:10,cachePerSecond:10,resetSpaceTime:10,resizeTimethreshold:1000,isStop:false};function c(){}c.prototype={initialize:function(d,e,f){this.root=d;
this.config=b.extend({},a,e||{});this.root.css("width","100%");this.maxWidth=this.root.width();if(this.maxWidth<this.config.minWidth){this.maxWidth=this.config.minWidth;
this.root.css("width",this.config.minWidth);}this.left=parseInt(this.root.css("padding-left"))||0;this.top=parseInt(this.root.css("padding-top"))||0;var m=1;
var g=0;if(this.maxWidth>this.config.itemWidth){m=Math.floor(this.maxWidth/this.config.itemWidth);g=this.maxWidth-this.config.itemWidth*m;var h=(m-1)*this.config.cellWSpace;
while(h>g){g+=this.config.itemWidth;m--;}}this.leaveSpace=g;this.maxColumns=m;this.initX=this.left+(this.leaveSpace-(this.maxColumns-1)*this.config.cellWSpace);
this.initX/=2;this.initY=this.top;this.columnsArray=[];for(var k=0,l=0;k<this.maxColumns;k++){var j={};if(k==0){j.x=this.initX;l=this.initX;}else{l+=this.config.itemWidth+this.config.cellWSpace;
j.x=l;}j.y=this.initY;j.index=k;this.columnsArray.push(j);}if(!f){this.cacheList=[];this.bindUI();}},destroy:function(){this.root.css(this.defaultCss);
this.root.empty();},bindUI:function(){var f=this.root.css("position"),d=this.root.css("height"),e=this;this.defaultCss={position:f,height:d};this.root.css({position:"relative",height:"auto"});
b(window).on("resize.waterfall",function(){if(e.isStop){return;}clearTimeout(e.resizeTimer);e.resizeTimer=setTimeout(function(){e.reset.call(e);},e.config.resizeTimethreshold);
});},render:function(d,e){this.initialize(d,e);return this;},fire:function(d,e){this.root.trigger(d,e);},on:function(d,e){this.root.on(d,b.proxy(e,this));
},setAnimate:function(d){this.animate=d||function(){};return this;},prependItem:function(f,d,e){this._addItem(f,d,e,true);this.reset();},appendItem:function(f,d,e){this._autoInsertItem(this._buildCacheItem(f,d,e));
return this;},reset:function(){this.reseting=true;this.initialize(this.root,this.config,true);this.fire("beforeReset");var d=this.root.find(">div");var e=[].slice.call(d.map(function(l,k){var j=b(k),h=j.height();
return{elem:j,height:h};}),0);var f=this;var g=1000/this.config.cachePerSecond;clearInterval(this.resetTimer);this.resetTimer=setInterval(function(){if(e.length<=0){clearInterval(f.resetTimer);
f.reseting=false;f._reflow();f.fire("reflow");return;}var j=e.shift();var i=j.elem;var h=f.columnsArray;i.animate({top:h[0].y,left:h[0].x},g);h[0].y+=f.config.cellHSpace+j.height;
f._sort();},this.config.resetSpaceTime||g);this.fire("reset");},_reflow:function(){this.root.css("zoom",1).css("zoom",0);},_buildCacheItem:function(f,d,e){return{elem:f,height:d,css:e};
},_autoInsertItem:function(e){this.cacheList.push(e);var f=this.cacheList,d=this;if(!this.cacheTimer){clearInterval(this.cacheTimer);this.cacheTimer=setInterval(function(){if(d.reseting){return;
}var g=f.shift();d._addItem(g.elem,g.height,g.css);if(f.length<=0){clearInterval(d.cacheTimer);d.cacheTimer=null;}},1000/this.config.cachePerSecond);}},_addItem:function(j,e,g,i){var h=this.config.itemWidth,e=e||"auto";
var d=this.columnsArray;var f=b("<div></div>").css({position:"absolute",width:h,height:e,top:d[0].y,left:d[0].x});g&&f.css(g);f.append(j);this.root[i?"prepend":"append"](f);
e=f.height();this.animate&&this.animate(j);d[0].y+=e+this.config.cellHSpace;this.fire("addItem",{elem:f});if(this._check()){this._sort();}else{this.reset();
}},_check:function(){return this.maxWidth==this.root.width();},_sort:function(){this.columnsArray.sort(function(f,e){if(f.y>e.y){return 1;}else{if(f.y==e.y){if(f.index>e.index){return 1;
}else{return -1;}}else{return -1;}}});var d=this.columnsArray;}};b.WaterfallLayout=function(d,e){return(new c()).render(d,e);};})(jQuery);
